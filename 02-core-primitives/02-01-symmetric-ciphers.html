<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Symmetric Ciphers ‚Äî XOR, AES, ChaCha20 - Sealed in Rust ‚Äî Domain-Driven Edition</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The example book covers examples.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-c697e5b5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-f418e634.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Sealed in Rust ‚Äî Domain-Driven Edition</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h2 id="symmetric-ciphers-xor-aes-chacha20--beyond"><a class="header" href="#symmetric-ciphers-xor-aes-chacha20--beyond">Symmetric Ciphers: XOR, AES, ChaCha20 &amp; Beyond</a></h2>
<blockquote>
<p>üîê <strong>Used in:</strong> VPNs, TLS (post-handshake), disk encryption, messaging apps</p>
<p>‚úÖ Still foundational in modern cryptography.</p>
</blockquote>
<h3 id="what-are-symmetric-ciphers"><a class="header" href="#what-are-symmetric-ciphers">What Are Symmetric Ciphers?</a></h3>
<p>Symmetric ciphers use the same key for both encryption and decryption. Unlike public-key cryptography, they don‚Äôt offer key exchange‚Äîbut they are much faster, making them ideal for bulk data encryption.</p>
<p>They are used everywhere: encrypted file systems, secure communications, and even inside protocols like TLS (after the handshake).</p>
<h3 id="xor-cipher--simplicity-that-teaches"><a class="header" href="#xor-cipher--simplicity-that-teaches">XOR Cipher ‚Äî Simplicity That Teaches</a></h3>
<blockquote>
<p>‚ö†Ô∏è Insecure. Demonstration-only (used in educational demos, malware obfuscation )</p>
</blockquote>
<p>Watch it on my <em>Fearless in Rust</em> channel: <a href="https://www.youtube.com/watch?v=wA-p_c19ZFw&amp;t=326s">XOR Cipher in Rust - Step by Step</a></p>
<!--
>‚ö†Ô∏è Annotate if a Rust crate exists + maturity level
-->
<p>We first explored XOR encryption in <a href="../01-foundations/01-04-first-code.html">Section 1.4: First Code ‚Äî A Naive XOR Encryptor</a>, where we built a full working example from scratch.</p>
<p>XOR is the simplest symmetric cipher: each byte of the message is XORed with a repeating key.
Reversibility is built-in ‚Äî XORing twice with the same key restores the original.</p>
<pre class="playground"><code class="language-rust">fn main() {
    let message = b"Hi, Rust!";
    let key = b"key";

    let encrypted = xor_encrypt(message, key);
    let decrypted = xor_encrypt(&amp;encrypted, key);

    println!("Encrypted: {:x?}", encrypted);
    println!("Decrypted: {}", String::from_utf8_lossy(&amp;decrypted));
}

pub fn xor_encrypt(input: &amp;[u8], key: &amp;[u8]) -&gt; Vec&lt;u8&gt; {
    input
        .iter()
        .enumerate()
        .map(|(i, &amp;byte)| byte ^ key[i % key.len()])
        .collect()
}</code></pre>
<blockquote>
<p><strong>üü¢ Conclusion</strong>
XOR encryption is reversible and stateless, which makes it simple and fast. But it lacks confusion and diffusion, so patterns in the input remain visible ‚Äî offering no real resistance to cryptanalysis.</p>
</blockquote>
<h3 id="feistel-networks--foundation-of-classic-block-ciphers"><a class="header" href="#feistel-networks--foundation-of-classic-block-ciphers">Feistel Networks ‚Äî Foundation of Classic Block Ciphers</a></h3>
<blockquote>
<p>‚ö†Ô∏è Cryptographically obsolete, but conceptually important (used in DES<sup class="footnote-reference" id="fr-DES-1"><a href="#footnote-DES">1</a></sup>, 3DES<sup class="footnote-reference" id="fr-3DES-1"><a href="#footnote-3DES">2</a></sup>)</p>
</blockquote>
<!--
> ‚ö†Ô∏èÔ∏è Annotate if a Rust crate exists + maturity level
-->
<p>Feistel networks are a clever way to build reversible encryption using any basic function‚Äîeven if that function itself can‚Äôt be reversed. That‚Äôs the key idea.</p>
<p>Each round applies a transformation to the data. Multiple rounds are chained to strengthen security.</p>
<p>Each round does the following:</p>
<ol>
<li>Takes two halves: Left (L) and Right (R)</li>
<li>Computes a function f(R, key)</li>
<li>Updates the pair as:</li>
</ol>
<pre><code class="language-vbnet">L‚ÇÇ = R‚ÇÅ
R‚ÇÇ = L‚ÇÅ ‚äï f(R‚ÇÅ, key)
</code></pre>
<p>To encrypt, let‚Äôs see it in Rust:</p>
<pre class="playground"><code class="language-rust">fn feistel_round(l: u8, r: u8, k: u8) -&gt; (u8, u8) {
    let f = r ^ k;
    (r, l ^ f)
}

fn main() {
    let left1: u8 = 0b1010_1010;  // 170
    let right1: u8 = 0b0101_0101; // 85
    let key: u8 = 0b1111_0000;   // 240

    let (left2, right2) = feistel_round(left1, right1, key);
    println!("Encrypted: ({}, {})", left2, right2);
}</code></pre>
<p>Decryption reuses the same function f, simply reversing the round transformation:</p>
<pre class="playground"><code class="language-rust">fn feistel_round(l1: u8, r1: u8, k: u8) -&gt; (u8, u8) {
    let f = r1 ^ k;
    (r1, l1 ^ f)
}

fn feistel_decrypt(l2: u8, r2: u8, k: u8) -&gt; (u8, u8) {
    let f = l2 ^ k;
    let l1 = r2 ^ f;
    (l1, l2)
}

fn main() {
    let left1: u8 = 0b1010_1010;  // 170
    let right1: u8 = 0b0101_0101; // 85
    let key: u8 = 0b1111_0000;   // 240

    let (left2, right2) = feistel_round(left1, right1, key);
    println!("Encrypted: ({}, {})", left2, right2);

    let (left_orig, right_orig) = feistel_decrypt(left2, right2, key);
    println!("Decrypted: ({}, {})", left_orig, right_orig);
}</code></pre>
<br>
Because encryption produces :
<pre><code class="language-pgsql">Encrypted ‚Üí (R, L ‚äï f(R, k))
</code></pre>
<p>Let‚Äôs define:</p>
<ul>
<li>L‚ÇÅ and R‚ÇÅ = original input</li>
<li>L‚ÇÇ = R‚ÇÅ and R‚ÇÇ = L‚ÇÅ ‚äï f(R‚ÇÅ, k)</li>
</ul>
<p>We receive (L‚ÇÇ, R‚ÇÇ) and want to recover (L‚ÇÅ, R‚ÇÅ):</p>
<ol>
<li>
<p>From encryption, we know L‚ÇÇ = R‚ÇÅ</p>
<ul>
<li>So: R‚ÇÅ = L‚ÇÇ</li>
</ul>
</li>
<li>
<p>And: R‚ÇÇ = L‚ÇÅ ‚äï f(R‚ÇÅ, k)</p>
<ul>
<li>Replace R‚ÇÅ with L‚ÇÇ</li>
<li>R‚ÇÇ = L‚ÇÅ ‚äï f(L‚ÇÇ, k)</li>
</ul>
</li>
<li>
<p>Rearranging to get L‚ÇÅ:</p>
<ul>
<li>L‚ÇÅ = R‚ÇÇ ‚äï f(L‚ÇÇ, k)</li>
</ul>
</li>
</ol>
<br>
So, decryption is
<pre><code class="language-pgsql">L‚ÇÅ = R‚ÇÇ ‚äï f(L‚ÇÇ, k)
R‚ÇÅ = L‚ÇÇ
</code></pre>
<blockquote>
<p><strong>üü¢ Conclusion</strong>
Reversibility comes from XOR being reversible and swapping the halves.
Feistel networks let you build reversible encryption even with non-invertible functions.
This idea shaped DES and similar ciphers.</p>
<p>Not used today due to known vulnerabilities, but conceptually essential.</p>
</blockquote>
<h3 id="substitutionpermutation-networks-spn"><a class="header" href="#substitutionpermutation-networks-spn">Substitution‚ÄìPermutation Networks (SPN)</a></h3>
<blockquote>
<p>‚ö†Ô∏è Software-only S-box implementations can leak secrets through cache timing. Modern AES implementations use hardware instructions (AES-NI) or constant-time software libraries.</p>
</blockquote>
<blockquote>
<p>‚ö†Ô∏è Used in AES<sup class="footnote-reference" id="fr-AES-1"><a href="#footnote-AES">3</a></sup>, Camellia<sup class="footnote-reference" id="fr-Camellia-1"><a href="#footnote-Camellia">4</a></sup>, and modern block ciphers.
Still dominant in current cipher architectures</p>
</blockquote>
<!--
> ‚ö†Ô∏è Annotate if a Rust crate exists + maturity level
-->
<p>Substitution-Permutation Networks (SPNs) are a powerful way to build secure block ciphers by layering simple operations repeated across multiple rounds to build a secure cipher.</p>
<p>Each round does the following:</p>
<ol>
<li>Substitution ‚Äì replace each byte using an S-box (non-linear mapping)</li>
<li>Permutation ‚Äì reorder bits or bytes to spread influence</li>
<li>Key mixing ‚Äì XOR the block with a round key</li>
</ol>
<p>Decryption reverses these steps in reverse order.</p>
<blockquote>
<p>üí° An S-box (substitution box) is a predefined table that maps each input byte to a new output byte.
Its goal is to introduce non-linearity ‚Äî meaning the output doesn‚Äôt follow any simple, predictable rule based on the input.
<br><br>
This non-linear mapping ensures that small changes in the input produce unpredictable changes in the output, making it impossible to reverse or model with linear equations ‚Äî a key requirement for secure encryption.</p>
</blockquote>
<br>
Let‚Äôs walk through a simple encryption of a 4-byte block.
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::convert::TryInto;

// Manually defined "shuffled" S-box (shortened for demo)
let s_box: [u8; 16] = [
   0x63, 0x7C, 0x77, 0x7B,
   0xF2, 0x6B, 0x6F, 0xC5,
   0x30, 0x01, 0x67, 0x2B,
   0xFE, 0xD7, 0xAB, 0x76,
];

// Step 1: Substitution with S-box
// ‚ö†Ô∏è input and output (substituted) must have the same size
// Otherwise, map() or indexing will panic at runtime
let input: [u8; 4] = [0x00, 0x03, 0x07, 0x0F];
let substituted: [u8; 4] = input.map(|b| s_box[b as usize]);

// Step 2: Permutation (custom byte reordering)
let permuted: [u8; 4] = [
   substituted[2], // byte 2 moves to pos 0
   substituted[0], // byte 0 ‚Üí pos 1
   substituted[3], // byte 3 ‚Üí pos 2
   substituted[1], // byte 1 ‚Üí pos 3
];

// Step 3: XOR with round key
let round_key: [u8; 4] = [0xF0, 0x0F, 0xAA, 0x55];
let encrypted: [u8; 4] = permuted
   .iter()
   .zip(round_key.iter())
   .map(|(a, b)| a ^ b)
   .collect::&lt;Vec&lt;u8&gt;&gt;()
   .try_into()
   .unwrap();


println!("Step        | Byte 0 | Byte 1 | Byte 2 | Byte 3");
println!("------------|--------|--------|--------|--------");
println!("Input       | {:02X}     | {:02X}     | {:02X}     | {:02X}", input[0], input[1], input[2], input[3]);
println!("Substituted | {:02X}     | {:02X}     | {:02X}     | {:02X}", substituted[0], substituted[1], substituted[2], substituted[3]);
println!("Permuted    | {:02X}     | {:02X}     | {:02X}     | {:02X}", permuted[0], permuted[1], permuted[2], permuted[3]);
println!("Encrypted   | {:02X}     | {:02X}     | {:02X}     | {:02X}", encrypted[0], encrypted[1], encrypted[2], encrypted[3]);
<span class="boring">}</span></code></pre>
<br>
To decrypt, reverse the steps in reverse order:
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::convert::TryInto;

// Same S-box used for encryption
let s_box: [u8; 16] = [
   0x63, 0x7C, 0x77, 0x7B,
   0xF2, 0x6B, 0x6F, 0xC5,
   0x30, 0x01, 0x67, 0x2B,
   0xFE, 0xD7, 0xAB, 0x76,
];

// Generate inverse S-box
let mut inverse_s_box = [0u8; 256];
for (i, &amp;val) in s_box.iter().enumerate() {
   inverse_s_box[val as usize] = i as u8;
}

// Encrypted block from the previous encryption output
let encrypted: [u8; 4] = [0x35, 0x6C, 0xDC, 0x2E];
let round_key: [u8; 4] = [0xF0, 0x0F, 0xAA, 0x55];

// Step 1: Undo XOR with round key
let xor_reversed: [u8; 4] = encrypted
        .iter()
        .zip(round_key.iter())
        .map(|(a, b)| a ^ b)
        .collect::&lt;Vec&lt;u8&gt;&gt;()
        .try_into()
        .unwrap();

// Step 2:  Reverse permutation
// Remember: original permutation was [2, 0, 3, 1]
// So now we must do: [1, 3, 0, 2]
let permuted_reversed: [u8; 4] = [
   xor_reversed[1], // was originally at index 0
   xor_reversed[3], // was at index 1
   xor_reversed[0], // was at index 2
   xor_reversed[2], // was at index 3
];

// Step 3: Inverse substitution using inverse_s_box
let decrypted: [u8; 4] = permuted_reversed.map(|b| inverse_s_box[b as usize]);


println!("Step        | Byte 0 | Byte 1 | Byte 2 | Byte 3");
println!("------------|--------|--------|--------|--------");
println!("Encrypted   | {:02X}     | {:02X}     | {:02X}     | {:02X}", encrypted[0], encrypted[1], encrypted[2], encrypted[3]);
println!("XOR Rev     | {:02X}     | {:02X}     | {:02X}     | {:02X}", xor_reversed[0], xor_reversed[1], xor_reversed[2], xor_reversed[3]);
println!("Perm Rev    | {:02X}     | {:02X}     | {:02X}     | {:02X}", permuted_reversed[0], permuted_reversed[1], permuted_reversed[2], permuted_reversed[3]);
println!("Decrypted   | {:02X}     | {:02X}     | {:02X}     | {:02X}", decrypted[0], decrypted[1], decrypted[2], decrypted[3]);
<span class="boring">}</span></code></pre>
<p>Why it works</p>
<ul>
<li>Substitution = confusion ‚Üí Hide relationships between plaintext and ciphertext</li>
<li>Permutation = diffusion ‚Üí Spread input influence across the block</li>
</ul>
<p>These are Shannon‚Äôs two pillars of secure ciphers.</p>
<blockquote>
<p>üí° Claude Shannon, widely considered the father of modern cryptography, introduced the concepts of confusion and diffusion in 1949 as the foundation of secure cipher design.</p>
</blockquote>
<blockquote>
<p><strong>üü¢ Conclusion</strong>
Substitution-Permutation Networks provide a simple yet powerful structure for building symmetric ciphers. They deliver the critical properties of confusion and diffusion, as first formalized by Claude Shannon in his foundational work on cryptographic security.</p>
</blockquote>
<h3 id="aes-advanced-encryption-standard---the-global-symmetric-standard"><a class="header" href="#aes-advanced-encryption-standard---the-global-symmetric-standard">AES (Advanced Encryption Standard)  ‚Äî The Global Symmetric Standard</a></h3>
<blockquote>
<p>üí° Used in TLS<sup class="footnote-reference" id="fr-TLS-1"><a href="#footnote-TLS">5</a></sup>, LUKS<sup class="footnote-reference" id="fr-LUKS-1"><a href="#footnote-LUKS">6</a></sup>, SSH<sup class="footnote-reference" id="fr-SSH-1"><a href="#footnote-SSH">7</a></sup>, mobile apps, and FIPS-certified systems<sup class="footnote-reference" id="fr-FIPS-1"><a href="#footnote-FIPS">8</a></sup>.
Secure, fast, and hardware-accelerated</p>
</blockquote>
<blockquote>
<p><img src="../images/cargo.png" alt="My Crate Logo" width="22" style="vertical-align: middle; margin-right: 6px;"> Crates used: <a href="https://crates.io/crates/aes">aes</a>, <a href="https://github.com/RustCrypto/block-modes">block_modes</a></p>
</blockquote>
<p>AES is a symmetric-key block cipher developed by Belgian cryptographers Vincent Rijmen and Joan Daemen. It was selected by NIST in 2001 as the successor to DES and 3DES.</p>
<p>AES operates on 128-bit blocks and supports key sizes of 128, 192, or 256 bits. It is based on a Substitution‚ÄìPermutation Network (SPN) and runs 10, 12, or 14 rounds depending on the key length.</p>
<p>It is standardized by FIPS-197, ISO/IEC<sup class="footnote-reference" id="fr-ISOIEC-1"><a href="#footnote-ISOIEC">9</a></sup>, and widely adopted in security protocols such as TLS, SSH, and IPsec<sup class="footnote-reference" id="fr-IPSec-1"><a href="#footnote-IPSec">10</a></sup>. AES is available in hardware on most modern CPUs, making it both fast and energy-efficient.</p>
<br>
<p>üß™ <strong>Code Example: AES-128-CBC Encryption &amp; Decryption</strong> (<a href="https://github.com/VinEckSie/sealed-in-rust/blob/main/rust_crypto_book_code/src/lib.rs">source code</a>)
We‚Äôll use the aes and block-modes crates to encrypt and decrypt a message using AES-128 in CBC mode<sup class="footnote-reference" id="fr-CBC-1"><a href="#footnote-CBC">11</a></sup> with PKCS7<sup class="footnote-reference" id="fr-PKCS7-1"><a href="#footnote-PKCS7">12</a></sup> padding.</p>
<pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use aes::Aes128;
use block_padding::Pkcs7;
use cbc::{Encryptor, Decryptor};
use cipher::{BlockEncryptMut, BlockDecryptMut, KeyIvInit};

pub fn run_aes_example() {
    let key = b"verysecretkey123";
    let iv = b"uniqueinitvector";
    let plaintext = b"Attack at dawn!";

    let mut buffer = plaintext.to_vec();
    let pos = buffer.len();
    buffer.resize(pos + 16, 0u8);

    let encryptor = Encryptor::&lt;Aes128&gt;::new(key.into(), iv.into());
    let ciphertext = encryptor
        .encrypt_padded_mut::&lt;Pkcs7&gt;(&amp;mut buffer, pos)
        .expect("encryption failure");

    println!("Ciphertext (hex): {}", hex::encode(ciphertext));

    let decryptor = Decryptor::&lt;Aes128&gt;::new(key.into(), iv.into());

    let mut ciphertext_buffer = ciphertext.to_vec();
    let decrypted = decryptor
        .decrypt_padded_mut::&lt;Pkcs7&gt;(&amp;mut ciphertext_buffer)
        .expect("decryption failure");

    println!("Decrypted text: {}", String::from_utf8_lossy(decrypted));
    assert_eq!(plaintext.to_vec(), decrypted);
}
<span class="boring">}</span></code></pre>
<p>Output:</p>
<pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Ciphertext (hex): a2ae0699ff0bc71e6ff43a32531d88
Decrypted text: Attack at dawn!
<span class="boring">}</span></code></pre>
<p>‚úÖ Use a unique IV (Initialization Vector) for every encryption, and never reuse a key/IV pair. Avoid ECB mode entirely, and prefer AEAD modes (e.g., AES-GCM) when available.</p>
<blockquote>
<p><strong>üü¢ Conclusion</strong></p>
<p>AES is the modern standard for symmetric encryption.</p>
<p>It is fast, secure, and hardware-accelerated ‚Äî making it ideal for both embedded systems and high-throughput servers.</p>
<p>When used correctly with a secure mode like CBC or GCM and proper key/IV management, AES provides strong resistance against all known practical attacks.</p>
</blockquote>
<h3 id="chacha20--modern-stream-cipher"><a class="header" href="#chacha20--modern-stream-cipher">ChaCha20 ‚Äî Modern Stream Cipher</a></h3>
<blockquote>
<p>üí° A stream cipher encrypts data one bit or byte at a time by XORing it with a pseudorandom keystream, instead of encrypting fixed-size blocks like a block cipher.</p>
</blockquote>
<blockquote>
<p>üí° Used in WireGuard<sup class="footnote-reference" id="fr-WIREGUARD-1"><a href="#footnote-WIREGUARD">13</a></sup>, TLS (on non-AES hardware<sup class="footnote-reference" id="fr-NONAES-1"><a href="#footnote-NONAES">14</a></sup>), mobile apps, messaging protocols, and security libraries.
Fast, simple, and naturally resistant to timing attacks.</p>
</blockquote>
<blockquote>
<p><img src="../images/cargo.png" alt="My Crate Logo" width="22" style="vertical-align: middle; margin-right: 6px;"> Crate used: <a href="https://crates.io/crates/chacha20">chacha20</a></p>
</blockquote>
<p>ChaCha20 is a modern stream cipher designed by Daniel J. Bernstein.</p>
<p>It is the streamlined successor to Salsa20<sup class="footnote-reference" id="fr-SALSA20-1"><a href="#footnote-SALSA20">15</a></sup>, offering improved diffusion and exceptional performance on all platforms ‚Äî especially devices without AES hardware.</p>
<p>Unlike block ciphers, ChaCha20 does not process data in fixed-size blocks. Instead, it transforms a key + nonce + counter into a pseudorandom keystream<sup class="footnote-reference" id="fr-PSEUDOKEY-1"><a href="#footnote-PSEUDOKEY">16</a></sup>.</p>
<p>Encryption is simply: ciphertext = plaintext XOR keystream</p>
<p>No padding. No block alignment. Just pure stream encryption.</p>
<p>ChaCha20 is now a fundamental primitive across modern cryptography:
WireGuard, OpenSSH (for session keys), TLS 1.3 fallback ciphers, mobile operating systems, and many authenticated encryption schemes like ChaCha20-Poly1305<sup class="footnote-reference" id="fr-POLY1305-1"><a href="#footnote-POLY1305">17</a></sup>.</p>
<p>üß™ <strong>Code Example: ChaCha20 Encryption &amp; Decryption</strong> (<a href="https://github.com/VinEckSie/sealed-in-rust/blob/main/rust_crypto_book_code/src/lib.rs">source code</a>)</p>
<p>We‚Äôll generate a ChaCha20 keystream and XOR it with a plaintext message.
The API is extremely simple ‚Äî you create a cipher and stream through it.</p>
<pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn run_chacha20_example() {
    use chacha20::cipher::{KeyIvInit, StreamCipher};
    use chacha20::ChaCha20;

    let key = *b"an example very very secret key!";
    let nonce = *b"unique nonce";
    let plaintext = b"Secret meeting at midnight".to_vec();

    let mut ciphertext = plaintext.clone();

    let mut encryptor = ChaCha20::new(&amp;key.into(), &amp;nonce.into());
    encryptor.apply_keystream(&amp;mut ciphertext);

    println!("Ciphertext (hex): {}", hex::encode(&amp;ciphertext));

    let mut decrypted = ciphertext.clone();
    let mut decryptor = ChaCha20::new(&amp;key.into(), &amp;nonce.into());
    decryptor.apply_keystream(&amp;mut decrypted);

    println!("Decrypted text: {}", String::from_utf8_lossy(&amp;decrypted));
    assert_eq!(plaintext, decrypted);
}
<span class="boring">}</span></code></pre>
<p>Output:</p>
<pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Ciphertext (hex): b0bf118af914c7127eb12a3a4a1489c262dcdd53e9563bfaf652
Decrypted text: Secret meeting at midnight
<span class="boring">}</span></code></pre>
<blockquote>
<p>üö® <strong>Security rule</strong> üö®</p>
<p><strong>Never reuse the same (key, nonce) pair. Doing so reveals keystream reuse ‚Üí instant compromise.</strong>
<strong>ChaCha20 itself is secure, but it becomes unsafe if you repeat a nonce.</strong></p>
</blockquote>
<blockquote>
<p><strong>üü¢ Conclusion</strong></p>
<p>ChaCha20 is the modern workhorse of stream ciphers: fast, extremely simple to implement correctly, and designed to avoid timing leaks by construction.</p>
<p>It performs brilliantly on laptops, phones, microcontrollers, and any platform lacking AES acceleration.</p>
<p>Use a fresh nonce for every encryption, treat keystreams as one-time pads, and avoid reuse. When authenticated encryption is needed, pair ChaCha20 with Poly1305 (ChaCha20-Poly1305).</p>
<p>ChaCha20 combines security, clarity, and performance ‚Äî a perfect fit for modern Rust systems, network protocols, and embedded environments.</p>
</blockquote>
<h3 id="modes-of-operation"><a class="header" href="#modes-of-operation">Modes of Operation</a></h3>
<p>Modern cryptography doesn‚Äôt encrypt ‚Äúmessages.‚Äù It encrypts <em>blocks</em>.
AES, for example, works on 128-bit chunks and nothing else.
So to handle real-world data‚Äîfiles, network packets, logs, telemetry‚Äîwe need a strategy to link those fixed-size blocks together safely.</p>
<p>That strategy is a mode of operation.</p>
<p>Modes are not decorative. They don‚Äôt sit on top of AES; they <em>define</em> its security. Pick the wrong one and your encryption leaks patterns. Pick the right one and you get confidentiality at scale.</p>
<p><strong>Why Modes Exist</strong></p>
<p>A block cipher is deterministic: same key + same block = same output.
That predictability is deadly when encrypting long messages.</p>
<p>Modes solve four problems:</p>
<ol>
<li>Randomness ‚Äî injecting unpredictability so repeated blocks don‚Äôt look the same.</li>
<li>Chaining ‚Äî connecting blocks so tampering affects more than one piece.</li>
<li>Streaming ‚Äî letting you encrypt arbitrary sizes efficiently.</li>
<li>State ‚Äî defining how to start, continue, and finish encryption safely.</li>
</ol>
<p><strong>Overview of Common Modes</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Mode</th><th>Secure?</th><th>Real Use Case</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td><strong>ECB</strong></td><td>‚ùå No</td><td>None (except teaching)</td><td>Leaks structure. Never use in production.</td></tr>
<tr><td><strong>CBC</strong></td><td>‚ö†Ô∏èRisky</td><td>Legacy protocols</td><td>Requires a random IV. Padding mistakes break it.</td></tr>
<tr><td><strong>CTR</strong></td><td>‚úÖ Yes</td><td>High-speed streaming, networking, I/O</td><td>Turns AES into a fast stream cipher. Very robust when nonce-unique.</td></tr>
<tr><td><strong>XTS</strong></td><td>‚úÖ Yes</td><td>Disk and sector encryption</td><td>Designed for storage only, not general messages.</td></tr>
</tbody>
</table>
</div>
<p><strong>ECB (Electronic Codebook) ‚Äî The Anti-Example</strong></p>
<p>ECB encrypts each block independently.
Patterns in the plaintext appear in the ciphertext.
Famous example: encrypting the Tux penguin still looks like a penguin.</p>
<p>If you see ECB in a system, assume the designer didn‚Äôt understand cryptography.</p>
<p><strong>CBC (Cipher Bloc Chaining) ‚Äî The Old Workhorse</strong></p>
<p>CBC chains each block with the previous one using XOR.
If the IV is truly random and padding is handled correctly, it‚Äôs fine.
But historically, padding-oracle attacks destroyed its safety in many protocols.</p>
<p>Today, CBC mostly survives in legacy stacks and old file formats.
New designs avoid it.</p>
<p><strong>CTR (Counter Mode) ‚Äî The Modern Default</strong></p>
<p>CTR mode transforms AES into a stream cipher.
Instead of encrypting the plaintext blocks directly, it encrypts a counter and XORs the result with the message.</p>
<p>This gives:</p>
<ul>
<li>high performance</li>
<li>random access</li>
<li>no padding</li>
<li>clean parallelism</li>
</ul>
<blockquote>
<p>üö®
The only hard rule: never reuse the same (key, nonce) pair.
Break that rule and attackers recover the XOR of two plaintexts.</p>
</blockquote>
<p><strong>CTR Example</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use aes::Aes128;
use ctr::cipher::{KeyIvInit, StreamCipher};

let mut cipher = ctr::Ctr128BE::&lt;Aes128&gt;::new(key.into(), nonce.into());
cipher.apply_keystream(&amp;mut buffer); // encrypt or decrypt
<span class="boring">}</span></code></pre>
<p>CTR is simple, fast, and well-suited to network protocols, telemetry pipelines, and embedded systems.</p>
<p><strong>XTS (XEX-based (XOR-Encrypt-XOR-based) Tweaked CodeBook with Ciphertext Stealing) ‚Äî Built for Storage</strong></p>
<p>XTS is AES-CTR + a ‚Äútweak‚Äù system tailored to disk sectors.
It prevents block relocation attacks and keeps each sector isolated.</p>
<p>XTS shines for full-disk encryption because it resists sector-copy tampering and is purpose-built for storage. It isn‚Äôt suitable for general messages or network data, and it requires two independent AES keys.</p>
<p>Use XTS only when you‚Äôre encrypting storage blocks.</p>
<p><strong>Key Takeaway</strong></p>
<p>Modes of operation are not optional add-ons.
They decide whether your encryption is safe or broken.</p>
<ul>
<li>
<p>ECB teaches you what not to do.</p>
</li>
<li>
<p>CBC reminds you legacy systems carry hidden risks.</p>
</li>
<li>
<p>CTR gives you modern, scalable encryption for streaming workloads.</p>
</li>
<li>
<p>XTS protects disks‚Äînothing else.</p>
</li>
</ul>

<p>If you understand modes, you understand how real-world encryption actually works.</p>
<h3 id="aes-vs-chacha20--which-one-should-you-choose"><a class="header" href="#aes-vs-chacha20--which-one-should-you-choose">AES vs. ChaCha20 ‚Äî Which One Should You Choose?</a></h3>
<p>Both AES and ChaCha20 are modern, secure, and widely deployed symmetric encryption algorithms. You will encounter them everywhere: in HTTPS, VPNs, mobile apps, cloud storage, and embedded systems.</p>
<p>Yet, choosing between them is not a matter of ‚Äúwhich is stronger‚Äù ‚Äî both are cryptographically secure. The real difference lies in performance, implementation safety, and hardware availability.</p>
<p><strong>AES (Advanced Encryption Standard)</strong></p>
<ul>
<li>Type: Block cipher</li>
<li>Strength: 128, 192, or 256-bit keys</li>
<li>Typical Modes Depends on the mode of operation used</li>
<li>Performance:  Extremely fast when hardware acceleration is available</li>
<li>Used In TLS, disk encryption, databases, government systems</li>
</ul>
<p>‚úÖ Strengths:</p>
<ul>
<li>Decades of analysis and trust</li>
<li>Hardware acceleration on most modern CPUs</li>
<li>Excellent for high-throughput systems</li>
</ul>
<p>‚ö†Ô∏è Weaknesses:</p>
<ul>
<li>More complex to implement correctly</li>
<li>Vulnerable to timing and cache side-channel attacks if implemented poorly</li>
</ul>
<p><strong>ChaCha20</strong></p>
<ul>
<li>Type: Stream cipher</li>
<li>Key Size: 256-bit</li>
<li>Performance: Fast on all CPUs, even without hardware support</li>
<li>Used In: Mobile apps, VPNs, embedded systems</li>
</ul>
<p>‚úÖ Strengths:</p>
<ul>
<li>Very simple design</li>
<li>Timing-attack resistant by design</li>
<li>Outstanding performance on low-power devices</li>
<li>Fewer catastrophic implementation mistakes</li>
</ul>
<p>‚ö†Ô∏è Weaknesses:</p>
<ul>
<li>No native hardware acceleration (yet)</li>
<li>Less common in legacy enterprise systems</li>
</ul>

<blockquote>
<p><strong>üü¢ Conclusion</strong></p>
<p>Use AES-GCM when you have hardware acceleration or when you need standardized enterprise compatibility</p>
<p>Use ChaCha20-Poly1305 when you target mobile, embedded, or low-power devices or you want maximum implementation safety or you care about side-channel resistance</p>
<p><strong>Important truth:</strong>
Both are safe when used correctly.
ChaCha20 is often preferred today when simplicity and portability matter more than raw throughput.</p>
</blockquote>
<h3 id="a-glimpse-at-key-derivation"><a class="header" href="#a-glimpse-at-key-derivation">A Glimpse at Key Derivation</a></h3>
<p><strong>What Goes Wrong Without a KDF (Real Consequence)</strong></p>
<p>Let‚Äôs say a beginner does this:</p>
<ul>
<li>Password = ‚Äúmysecret123‚Äù</li>
<li>Key for AES = ‚Äúmysecret123‚Äù</li>
</ul>
<p>This is cryptographically broken, even if AES itself is mathematically perfect.</p>
<p>Because:</p>
<ul>
<li>The password has low entropy</li>
<li>It exists in wordlists</li>
<li>It can be tested at billions of attempts per second</li>
<li>The attacker does not break AES ‚Äî they simply break the password</li>
</ul>
<p>This is the single biggest real-world cryptographic failure.</p>
<p>‚úÖ <strong>A Key Derivation Function (KDF) converts a weak human secret into a strong cryptographic key suitable for AES or ChaCha20.</strong>
<strong>It is a conversion machine between two worlds</strong>:</p>
<p>Human Password ‚Üí KDF ‚Üí Cryptographic Key ‚Üí AES / ChaCha20</p>
<p>A KDF protects symmetric encryption by:</p>
<ul>
<li>Adding randomness (salt<sup class="footnote-reference" id="fr-SALT-1"><a href="#footnote-SALT">18</a></sup>)</li>
<li>Applying slow, repeated cryptographic operations</li>
<li>Making brute-force attacks economically unviable</li>
</ul>
<p><strong>Common KDF Families</strong></p>
<ul>
<li><strong>PBKDF2<sup class="footnote-reference" id="fr-PBKDF2-1"><a href="#footnote-PBKDF2">19</a></sup></strong> ‚Üí Legacy compatibility</li>
<li><strong>Argon2<sup class="footnote-reference" id="fr-ARGON2-1"><a href="#footnote-ARGON2">20</a></sup></strong> ‚Üí Modern password-based security standard</li>
<li><strong>scrypt<sup class="footnote-reference" id="fr-SCRYPT-1"><a href="#footnote-SCRYPT">21</a></sup></strong> ‚Üí Memory-hard defense against hardware attacks</li>
<li><strong>HKDF<sup class="footnote-reference" id="fr-HKDF-1"><a href="#footnote-HKDF">22</a></sup></strong> ‚Üí Safe key expansion from an already strong secret</li>
</ul>
<p><strong>Important Distinction</strong></p>
<ul>
<li>Human password ‚Üí Argon2 / scrypt</li>
<li>Existing cryptographic secret ‚Üí HKDF</li>
</ul>
<blockquote>
<p>üö®
<strong>They solve different security problems and must never be confused.</strong></p>
</blockquote>
<p>üß™ <strong>Code Example: HKDF</strong></p>
<pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use hkdf::Hkdf;
use sha2::Sha256;

let hk = Hkdf::&lt;Sha256&gt;::new(Some(salt), ikm);
let mut okm = [0u8; 32];
hk.expand(b"encryption key", &amp;mut okm).unwrap();
<span class="boring">}</span></code></pre>
<p>HKDF is used to derive multiple secure keys from a single master secret.</p>
<p>This allows you to:</p>
<ul>
<li>Derive separate keys for encryption, authentication, and signatures</li>
<li>Avoid key reuse</li>
<li>Maintain cryptographic isolation</li>
</ul>
<blockquote>
<p>üö® <strong>Critical Security Rule</strong></p>
<p><strong>Never use user passwords directly as encryption keys. Ever.</strong></p>
<p><strong>Always apply:</strong></p>
<ul>
<li><strong>a salt</strong></li>
<li><strong>a slow KDF</strong></li>
<li><strong>a modern hash function</strong></li>
</ul>
<p><strong>Without this step, your entire encryption system is compromised before it even begins.</strong></p>
</blockquote>
<hr>
<ol class="footnote-definition">
<li id="footnote-DES">
<p>DES ‚Äî early symmetric cipher (56-bit), now insecure. <a href="../99-appendices/99-01-glossary.html#des-data-encryption-standard">More</a> <a href="#fr-DES-1">‚Ü©</a></p>
</li>
<li id="footnote-3DES">
<p>3DES ‚Äî DES applied three times, better than DES but now deprecated. <a href="../99-appendices/99-01-glossary.html#3des-triple-des">More</a> <a href="#fr-3DES-1">‚Ü©</a></p>
</li>
<li id="footnote-AES">
<p>AES ‚Äî The modern global standard, fast, secure, and hardware-accelerated. <a href="../99-appendices/99-01-glossary.html#aes-advanced-encryption-standard">More</a> <a href="#fr-AES-1">‚Ü©</a></p>
</li>
<li id="footnote-Camellia">
<p>Camellia ‚Äî Japanese block cipher, secure &amp; AES-comparable. <a href="../99-appendices/99-01-glossary.html#camellia">More</a> <a href="#fr-Camellia-1">‚Ü©</a></p>
</li>
<li id="footnote-TLS">
<p>TLS ‚Äî protocol securing data in transit (HTTPS, etc.). <a href="../99-appendices/99-01-glossary.html#tls-transport-layer-security">More</a> <a href="#fr-TLS-1">‚Ü©</a></p>
</li>
<li id="footnote-LUKS">
<p>LUKS ‚Äî Linux standard for full disk encryption. <a href="../99-appendices/99-01-glossary.html#luks-linux-unified-key-setup">More</a> <a href="#fr-LUKS-1">‚Ü©</a></p>
</li>
<li id="footnote-SSH">
<p>SSH ‚Äî secure remote access protocol. <a href="../99-appendices/99-01-glossary.html#ssh-secure-shell">More</a> <a href="#fr-SSH-1">‚Ü©</a></p>
</li>
<li id="footnote-FIPS">
<p>FIPS ‚Äî U.S. cryptographic standards for government/finance. <a href="../99-appendices/99-01-glossary.html#fips-federal-information-processing-standards">More</a> <a href="#fr-FIPS-1">‚Ü©</a></p>
</li>
<li id="footnote-ISOIEC">
<p>ISO/IEC ‚Äî international standards for IT/crypto. <a href="../99-appendices/99-01-glossary.html#isoiec">More</a> <a href="#fr-ISOIEC-1">‚Ü©</a></p>
</li>
<li id="footnote-IPSec">
<p>IPSec ‚Äî protocol suite for securing IP communications. <a href="../99-appendices/99-01-glossary.html#ipsec">More</a> <a href="#fr-IPSec-1">‚Ü©</a></p>
</li>
<li id="footnote-CBC">
<p>CBC ‚Äî block cipher mode, chains blocks for security. <a href="../99-appendices/99-01-glossary.html#cbc-cipher-block-chaining">More</a> <a href="#fr-CBC-1">‚Ü©</a></p>
</li>
<li id="footnote-PKCS7">
<p>PKCS7 ‚Äî padding scheme for block ciphers. <a href="../99-appendices/99-01-glossary.html#pkcs7">More</a> <a href="#fr-PKCS7-1">‚Ü©</a></p>
</li>
<li id="footnote-WIREGUARD">
<p>WireGuard ‚Äî modern VPN protocol using ChaCha20-Poly1305 to secure IP traffic. <a href="../99-appendices/99-01-glossary.html#wireguard">More</a> <a href="#fr-WIREGUARD-1">‚Ü©</a></p>
</li>
<li id="footnote-NONAES">
<p>Non-AES hardware ‚Äî CPUs without AES instructions, where ChaCha20 is often faster than AES. <a href="../99-appendices/99-01-glossary.html#non-aes-hardware">More</a> <a href="#fr-NONAES-1">‚Ü©</a></p>
</li>
<li id="footnote-SALSA20">
<p>Salsa20 ‚Äî stream cipher by Daniel J. Bernstein; predecessor of ChaCha20, fast and well-studied. <a href="../99-appendices/99-01-glossary.html#salsa20">More</a> <a href="#fr-SALSA20-1">‚Ü©</a></p>
</li>
<li id="footnote-PSEUDOKEY">
<p>Pseudorandom keystream - sequence of bits/bytes that looks random but is deterministically generated from a secret key (and usually a nonce). <a href="../99-appendices/99-01-glossary.html#pseudorandom-keystream">More</a> <a href="#fr-PSEUDOKEY-1">‚Ü©</a></p>
</li>
<li id="footnote-POLY1305">
<p>ChaCha20-Poly1305 -
AEAD scheme that combines the ChaCha20 stream cipher with the Poly1305 MAC to provide authenticated encryption (confidentiality + integrity). <a href="../99-appendices/99-01-glossary.html#chacha20-poly1305">More</a> <a href="#fr-POLY1305-1">‚Ü©</a></p>
</li>
<li id="footnote-SALT">
<p>Salt - A random value added to a password before key derivation to prevent identical passwords from producing identical keys and to defeat precomputed attacks such as rainbow tables.. <a href="../99-appendices/99-01-glossary.html#salt">More</a> <a href="#fr-SALT-1">‚Ü©</a></p>
</li>
<li id="footnote-PBKDF2">
<p>PBKDF2 (Password-Based Key Derivation Function) - The standardized successor to PBKDF1 for deriving cryptographic keys from passwords.. <a href="../99-appendices/99-01-glossary.html#pbkdf2">More</a> <a href="#fr-PBKDF2-1">‚Ü©</a></p>
</li>
<li id="footnote-ARGON2">
<p>Argon2 (named after the mythological ship Argo and its crew, the Argonauts) - The modern standard for password hashing and key derivation, designed to resist GPU and ASIC attacks using memory-hard computation. <a href="../99-appendices/99-01-glossary.html#argon2">More</a> <a href="#fr-ARGON2-1">‚Ü©</a></p>
</li>
<li id="footnote-SCRYPT">
<p>Scrypt -
A memory-hard password-based key derivation function built to make large-scale hardware brute-force attacks expensive and inefficient. Older than Argon2 but still widely used. <a href="../99-appendices/99-01-glossary.html#scrypt">More</a> <a href="#fr-SCRYPT-1">‚Ü©</a></p>
</li>
<li id="footnote-HKDF">
<p>HKDF (HMAC-based Key Derivation Function) -
A key derivation function for expanding an already strong secret into multiple independent cryptographic keys using hash functions. Used for key separation and key hygiene, not for protecting weak passwords. <a href="../99-appendices/99-01-glossary.html#hkdf">More</a> <a href="#fr-HKDF-1">‚Ü©</a></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../01-foundations/01-05-tooling-up.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../02-core-primitives/02-02-crypto-hashes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../01-foundations/01-05-tooling-up.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../02-core-primitives/02-02-crypto-hashes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
